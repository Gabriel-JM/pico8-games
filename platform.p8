pico-8 cartridge // http://www.pico-8.com
version 34
__lua__
function _init()
	map_start_x=0
	debug=nil
	blocks=nil
	dirs=[
		split"-1,0,1,0",
		split"0,-1,0,1"
	]
	
	_upd=update_game
	_drw=draw_game
	start_game()
end

function _update()
	_upd()
end

function _draw()
	_drw()
end

function start_game()
	frames=0
	plyr={
		x=10,
		y=10,
		w=8,
		h=8,
		map_x=1,
		map_y=1,
		speed=3,
		jump=0,
		in_ground=true,
		spr=1,
		flip=false
	}
end
-->8
-- updates

function update_start()
	if btnp(❎) then
		_upd=update_game
		_drw=draw_game
	end
end

function update_game()
	local speed=plyr.speed
	local walk_dir=[0,0]
	
	if not blocks then
		blocks={}
		for x=0,15 do
			for y=0,15 do
				if fget(mget(x,y),0) then
					add(blocks,{x=x,y=y})
				end
			end
		end
	end
	
	if frames>3000 then
		frames=-1
	end
	
	frames+=1
	
	if btnp(➡️) then
		plyr.x+=speed
		plyr.flip=false
		plyr.map_x=flr(plyr.x/8)
		walk_dir=[1,0]
	end
	if btnp(⬅️) then
		plyr.x-=speed
		plyr.flip=true
		plyr.map_x=flr(plyr.x/8)
		walk_dir=[-1,0]
	end
	if btnp(⬆️) then
		plyr.y-=speed
		plyr.map_y=flr(plyr.y/8)
		walk_dir=[0,-1]
	end
	if btnp(⬇️) then
		plyr.y+=speed
		plyr.map_y=flr(plyr.y/8)
		walk_dir=[0,1]
	end

	foreach(blocks,function(b)
		if verify_collision(
			plyr,{
				x=b.x*8,
				y=b.y*8,
				w=8,
				h=8
		}) then
			
		end
	end)
end

function verify_collision(
	tgt1,tgt2
)
	if (
		tgt1.x > tgt2.x+tgt2.w or
		tgt1.x+tgt1.w < tgt2.x or
		tgt1.y > tgt2.y+tgt2.h or
		tgt1.y+tgt1.h < tgt2.y
	) then
		return false
	end
	
	return true
end
-->8
-- draw

function draw_start()
	cls()
	print(
		"press ❎ to start",
		20,
		30
	)
end

function draw_game()
	cls()
	map()
	
--	if not blocks then
--		blocks={}
--		for x=0,15 do
--			for y=0,15 do
--				if fget(mget(x,y),1) then
--					add(blocks,{x=x,y=y})
--				end
--			end
--		end
--	end
	
	print(debug)
	
	palt(0,false)
	spr(
		plyr.spr+((frames/30)%2),
		plyr.x,
		plyr.y,
		1,
		1,
		plyr.flip,
		nil
	)
	palt()
	print(
		"map x:"..plyr.map_x..
		" y:"..plyr.map_y,
		60,
		10,
		8
	)
	rect(
		plyr.map_x*8,
		plyr.map_y*8,
		plyr.map_x*8+1,
		plyr.map_y*8+1,
		8
	)
	foreach(blocks,function(b)
		rect(
			b.x*8,b.y*8,
			b.x*8+8,b.y*8+8,8
		)
	end)
end
__gfx__
00000000000000000088000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000008800000086666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700008666600006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000600000006606000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000660600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700066000000066060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000066066060066060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000606000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66606660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
60666060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66606660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
60666060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
